<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produtos</title>
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <section class="container">
        <!-- Link para voltar ao menu principal -->
        <a href="/menu" class="voltar">‚Üê Voltar ao Menu</a>

        <br />
        <br />

        <h2>üì¶ Cadastro de Produtos</h2>
        
       <section class="form-section">
    <h3>Novo Produto</h3>
    
    <form action="/produtos" method="POST">
        
        <section class="form-row">
            <section><input type="text" name="nome" placeholder="Nome do Produto *" required></section>

            <section>
                <select name="idcategoria">
                    <option value="">Categoria</option>
                    <% categorias.forEach(c => { %>
                        <option value="<%= c.idcategoria %>"><%= c.nome %></option>
                    <% }) %>
                </select>
            </section>

            <section><input type="text" name="fabricante" placeholder="Fabricante"></section>
        </section>

        <section class="form-row">
            <section><input type="number" name="preco_venda" placeholder="Pre√ßo de Venda" step="0.01"></section>
            <section><input type="number" name="estoque_minimo" placeholder="Estoque M√≠nimo"></section>
        </section>

        <section>
            <input type="text" name="descricao" placeholder="Descri√ß√£o">
        </section>
        
        <button type="submit">Adicionar Produto</button>
    </form>
</section>

        <!-- Se houver erro, exibe a mensagem de erro -->
        <% if (error) { %>
            <p class="error">‚ö†Ô∏è <%= error %></p>
        <% } %>

        <!-- Wrapper da tabela com scroll horizontal -->
        <section class="table-wrapper">
            <!-- Tabela que lista todos os produtos -->
            <table>
                <!-- Header da tabela -->
                <tr>
                    <th>A√ß√µes</th>     <!-- Bot√µes editar/excluir -->
                    <th>ID</th>        <!-- ID do produto -->
                    <th>Nome</th>      <!-- Nome do produto -->
                    <th>Categoria</th> <!-- Categoria do produto -->
                    <th>Fabricante</th><!-- Fabricante -->
                    <th>Pre√ßo</th>     <!-- Pre√ßo de venda -->
                    <th>Estoque Atual</th> <!-- Saldo atual -->
                    <th>Estoque M√≠nimo</th><!-- M√≠nimo permitido -->
                    <th>Descri√ß√£o</th> <!-- Descri√ß√£o -->
                </tr>
                
                <!-- Loopa pelos produtos e cria uma linha para cada -->
                <% produtos.forEach(prod => { %>
                    <tr>
                        <!-- C√©lula com bot√µes de a√ß√£o -->
                        <td>
                            <section class="action-buttons">
                                <!-- Link para editar o produto -->
                                <a href="/produtos/editar/<%= prod.idproduto %>">
                                    <button type="button">‚úèÔ∏è Editar</button>
                                </a>
                                
                                <!-- Formul√°rio para excluir o produto -->
                                <form action="/produtos/excluir/<%= prod.idproduto %>" method="POST">
                                    <!-- Bot√£o com confirma√ßao antes de excluir -->
                                    <button type="submit" class="btn-danger" onclick="return confirm('Tem certeza que deseja excluir?')">üóëÔ∏è Excluir</button>
                                </form>
                            </section>
                        </td>
                        
                        <!-- Dados do produto em cada coluna -->
                        <td><%= prod.idproduto %></td>
                        <td><%= prod.nome %></td>
                        <td><%= prod.categoria_nome || '-' %></td> <!-- Ou '-' se vazio -->
                        <td><%= prod.fabricante || '-' %></td>
                        <td>R$ <%= parseFloat(prod.preco_venda).toFixed(2) %></td> <!-- Formata como moeda -->
                        <td><%= prod.estoque_atual || 0 %></td> <!-- Ou 0 se vazio -->
                        <td><%= prod.estoque_minimo %></td>
                        <td><%= prod.descricao || '-' %></td>
                    </tr>
                <% }) %>
            </table>
        </section>
        
    </section>
</body>
</html>